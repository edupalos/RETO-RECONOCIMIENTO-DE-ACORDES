<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reto de acordes</title>
<style>
body {
  font-family: sans-serif;
  background: #0f172a;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  text-align: center;
}
button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 6px;
  font-size: 1em;
  cursor: pointer;
}
button:disabled {
  background: #475569;
  cursor: not-allowed;
}
#resultado {
  margin-top: 1em;
  font-weight: bold;
}
#contador {
  margin-top: 1em;
  color: #38bdf8;
  font-size: 1.1em;
}
#felicitacion {
  margin-top: 1em;
  font-size: 1.5em;
  color: #facc15;
  font-weight: bold;
}
</style>
</head>
<body>
<h1>ğŸµ Reto: Â¿Mayor o menor?</h1>
<div>
  <button id="btnNuevo">ğŸ”Š Reproducir acorde</button>
  <button id="btnRepetir" disabled>ğŸ” Repetir</button>
</div>
<div>
  <button id="btnMayor" disabled>Mayor</button>
  <button id="btnMenor" disabled>Menor</button>
</div>
<div>
  <button id="btnSiguiente" disabled>â¡ï¸ Siguiente pregunta</button>
</div>

<p id="resultado"></p>
<p id="contador">Aciertos consecutivos: 0</p>
<p id="felicitacion"></p>

<script>
let audioCtx;
let tipoCorrecto = "";
let bloqueado = false;
let ultimaTriada = [];
let aciertos = 0;

function reproducirArpegio(freqs) {
  const now = audioCtx.currentTime;
  freqs.forEach((f, i) => {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.value = f;
    osc.type = "sine";
    osc.connect(gain).connect(audioCtx.destination);
    gain.gain.setValueAtTime(0.001, now + i * 0.5);
    gain.gain.linearRampToValueAtTime(0.2, now + i * 0.5 + 0.05);
    gain.gain.linearRampToValueAtTime(0.001, now + (i + 1) * 0.5);
    osc.start(now + i * 0.5);
    osc.stop(now + (i + 1) * 0.5);
  });
}

function notaAFreq(nota, octava = 4) {
  const mapa = { C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 };
  const midi = 60 + mapa[nota] + (octava - 4) * 12;
  return 440 * Math.pow(2, (midi - 69) / 12);
}

function reproducirAcorde() {
  const notas = ["C", "D", "E", "F", "G", "A", "B"];
  const base = notas[Math.floor(Math.random() * notas.length)];
  tipoCorrecto = Math.random() > 0.5 ? "mayor" : "menor";
  const baseFreq = notaAFreq(base, 4);
  const tercera = baseFreq * Math.pow(2, (tipoCorrecto === "mayor" ? 4 : 3) / 12);
  const quinta = baseFreq * Math.pow(2, 7 / 12);
  ultimaTriada = [baseFreq, tercera, quinta];
  reproducirArpegio(ultimaTriada);

  bloqueado = true;
  mayor.disabled = false;
  menor.disabled = false;
  repetir.disabled = false;
  siguiente.disabled = true;
  res.textContent = "";
  felicitacion.textContent = "";
}

function verificar(respuesta) {
  if (!bloqueado) return;
  if (respuesta === tipoCorrecto) {
    res.textContent = "âœ… Â¡Correcto! Era " + tipoCorrecto;
    res.style.color = "#4ade80";
    aciertos++;
    if (aciertos === 5) {
      felicitacion.textContent = "ğŸ‰ Â¡Excelente!";
      aciertos = 0; // reinicia el contador
    }
  } else {
    res.textContent = "âŒ Era " + tipoCorrecto;
    res.style.color = "#f87171";
    aciertos = 0;
  }
  contador.textContent = "Aciertos consecutivos: " + aciertos;

  bloqueado = false;
  mayor.disabled = true;
  menor.disabled = true;
  siguiente.disabled = false;
}

const nuevo = document.getElementById("btnNuevo");
const repetir = document.getElementById("btnRepetir");
const mayor = document.getElementById("btnMayor");
const menor = document.getElementById("btnMenor");
const siguiente = document.getElementById("btnSiguiente");
const res = document.getElementById("resultado");
const contador = document.getElementById("contador");
const felicitacion = document.getElementById("felicitacion");

nuevo.addEventListener("click", async () => {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  await audioCtx.resume();
  reproducirAcorde();
});

repetir.addEventListener("click", () => {
  if (audioCtx && ultimaTriada.length > 0) reproducirArpegio(ultimaTriada);
});

mayor.addEventListener("click", () => verificar("mayor"));
menor.addEventListener("click", () => verificar("menor"));
siguiente.addEventListener("click", reproducirAcorde);
</script>
</body>
</html>
